<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subhub</title>
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <!-- Login Section -->
  <div id="login-section" class="login-section">
    <h2>Login</h2>
    <form id="login-form">
      <input type="text" id="username" class="input-field" placeholder="Username">
      <input type="password" id="password" class="input-field" placeholder="Password">
      <button type="submit" id="login-btn">Login</button>
    </form>
    <p>Don't have an account? <a href="#register-section">Register</a></p>
    <p>Forgot password? <a href="#forgot-password-section">Reset</a></p>
  </div>


  <!-- Registration Section -->
  <div id="register-section" class="register-section" style="display: none;">
    <h2>Register</h2>
    <form id="register-form">
      <input type="text" id="new-username" class="input-field" placeholder="Username">
      <input type="text" id="new-name" class="input-field" placeholder="Name">
      <input type="email" id="new-email" class="input-field" placeholder="Email">
      <input type="password" id="new-password" class="input-field" placeholder="Password">
      <input type="password" id="reenter-new-password" class="input-field" placeholder="Re-enter Password">
      <button type="submit" id="register-btn">Register</button>
    </form>
  </div>

  <!-- Forgot Password Section -->
  <div id="forgot-password-section" class="forgot-password-section" style="display: none;">
    <h2>Forgot Password</h2>
    <form id="forgot-password-form">
      <input type="email" id="forgot-email" class="input-field" placeholder="Email">
      <button type="submit" id="forgot-password-btn">Submit</button>
    </form>
  </div>

  <!-- Enter Verification Code for user verification -->
  <div id="verification-code-section" style="display: none;">
    <h2>Enter Verification Code</h2>
    <form id="verification-code-form">
      <input type="text" id="verification-code" class="input-field" placeholder="Verification Code" pattern="[0-9]{6}"
        required>
      <button type="submit" id="verify-code-btn">Verify</button>
    </form>
  </div>


  <!-- Subscription Cards Section -->
  <div id="subscription-cards" style="display: none;">
    <!-- Cards will be dynamically added here -->
  </div>

  <!-- Subscription List -->
  <div id="subscription-list" style="display: none">
    <!-- Netflix Subscription -->
    <ul>
      <li class="subscription">
        <h3>Netflix</h3>
        <button class="view-btn" data-provider="netflix">View</button>
        <button class="cancel-btn" data-provider="netflix">Cancel</button>
      </li>
      <!-- Amazon Prime Subscription -->
      <li class="subscription">
        <h3>Amazon Prime</h3>
        <button class="view-btn" data-provider="amazon">View</button>
        <button class="cancel-btn" data-provider="amazon">Cancel</button>
      </li>
    </ul>

    <!-- Plus Button to add a new subscription -->
    <button class="plus-button" id="add-subscription-btn">+</button>
  </div>
  <!-- Form to add a new subscription -->
  <div id="add-subscription-form" class="form-section" style="display: none;">
    <input type="text" id="subscription-name" class="input-field" placeholder="Subscription Name">
    <input type="text" id="subscription-url" class="input-field" placeholder="Subscription URL">
    <input type="text" id="subscription-cancel-url" class="input-field" placeholder="Subscription Settings URL">
    <input type="date" id="subscription-start-date" class="input-field" placeholder="Start Date">
    <button id="save-subscription-btn" class="action-btn">Save</button>
  </div>

  <script src="popup.js"></script>
  <script>


 // Handle login form submission
document.getElementById('login-form').addEventListener('submit', function (event) {
  event.preventDefault(); // Prevent form submission

  // Check if username and password are correct (for demonstration purposes)
  var username = document.getElementById('username').value;
  var password = document.getElementById('password').value;

  // Prepare data to send to the API
  var data = {
    username: username,
    password: password
  };

  // For demonstration, let's assume any non-empty username and password combination is valid
  if (username.trim() !== '' && password.trim() !== '') {
    // Send a POST request to the API endpoint
    fetch('https://fw79wa9t2e.execute-api.us-east-1.amazonaws.com/dev/auth-signin', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
      .then(response => {
        if (response.ok) {
          // If login is successful, show the subscription list
          document.getElementById('login-section').style.display = 'none';
          document.getElementById('subscription-list').style.display = 'block';
          // Call getSubscriptions function with the username
          getSubscriptions(username);
        } else {
          // If login fails, display an error message
          alert('Login failed. Please check your credentials.');
        }
      })
      .catch(error => {
        // Handle any errors that occur during the fetch request
        console.error('Error:', error);
        alert('An error occurred. Please try again later.');
      });
  }
});

// Handle register link click
document.querySelector('#login-section a[href="#register-section"]').addEventListener('click', function (event) {
  event.preventDefault();
  document.getElementById('login-section').style.display = 'none'; // Hide login section
  document.getElementById('register-section').style.display = 'block'; // Show register section
});

// Handle register form submission
document.getElementById('register-form').addEventListener('submit', function (event) {
  event.preventDefault(); // Prevent form submission

  // Get the entered username and password
  var newUsername = document.getElementById('new-username').value;
  var newPassword = document.getElementById('new-password').value;
  var newEmail = document.getElementById('new-email').value;
  var newName = document.getElementById('new-name').value;

  // Prepare data to send to the API
  var registerData = {
    username: newUsername,
    password: newPassword,
    email: newEmail,
    name: newName
  };

  console.log(registerData);

  // Send a POST request to the signup API endpoint
  fetch('https://fw79wa9t2e.execute-api.us-east-1.amazonaws.com/dev/auth-signup', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(registerData)
  })
    .then(response => {
      if (response.ok) {
        // If signup is successful, display a success message
        alert('Signup successful! Please check your email for verification.');
        // Hide register section and show verification code section
        document.getElementById('register-section').style.display = 'none';
        document.getElementById('verification-code-section').style.display = 'block';
      } else {
        // If signup fails, display an error message
        alert('Signup failed. Please try again later.');
      }
    })
    .catch(error => {
      // Handle any errors that occur during the fetch request
      console.error('Error:', error);
      alert('An error occurred. Please try again later.');
    });
});

// Handle verification code form submission
document.getElementById('verification-code-form').addEventListener('submit', function (event) {
  event.preventDefault(); // Prevent form submission

  // Get the entered verification code
  var verificationCode = document.getElementById('verification-code').value;

  // Send the verification code to the API endpoint
  fetch('https://fw79wa9t2e.execute-api.us-east-1.amazonaws.com/dev/auth-confirm-signup', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      username: document.getElementById('new-username').value,
      confCode: verificationCode
    })
  })
    .then(response => {
      if (response.ok) {
        // Handle successful verification
        // For example, show a success message and redirect the user
        console.log('Verification successful');
        // Redirect the user to a new page or perform other actions
        document.getElementById('verification-code-section').style.display = 'none';
        document.getElementById('subscription-list').style.display = 'block';
      } else {
        // Handle verification error
        // For example, show an error message to the user
        console.error('Verification failed');
      }
    })
    .catch(error => {
      console.error('Error verifying code:', error);
    });
});

document.getElementById('add-subscription-btn').addEventListener('click', function (event) {
  event.preventDefault(); // Prevent default button behavior

  // Hide all sections except the add-subscription-form
  document.getElementById('login-section').style.display = 'none';
  document.getElementById('register-section').style.display = 'none';
  document.getElementById('forgot-password-section').style.display = 'none';
  document.getElementById('verification-code-section').style.display = 'none';
  document.getElementById('subscription-list').style.display = 'none';

  // Display the add-subscription-form section
  document.getElementById('add-subscription-form').style.display = 'block';
});

// get subscriptions
function getSubscriptions(username) {
  fetch(`https://7se83qeyid.execute-api.us-east-1.amazonaws.com/dev/subscriptions/list/${username}`)
    .then(response => response.json())
    .then(data => {
      // Clear any existing subscription cards
      const subscriptionCards = document.getElementById('subscription-cards');
      subscriptionCards.innerHTML = '';

      console.log(data)
      const jsonData = JSON.parse(data);

      const subscriptions = jsonData.subscriptions;

      console.log('Subscriptions:', jsonData.subscriptions);

      // Loop through the subscription data and create cards
      jsonData.subscriptions.forEach(subscription => {
        const card = document.createElement('div');
        card.classList.add('subscription-card');

        // Create elements for displaying subscription details

        const vendorNameElement = document.createElement('p');
        vendorNameElement.textContent = `Vendor Name: ${subscription.vendor_name}`;
        card.appendChild(vendorNameElement);

        const vendorURLElement = document.createElement('p');
        vendorURLElement.textContent = `Vendor URL: ${subscription.vendor_url}`;
        card.appendChild(vendorURLElement);

        const durationElement = document.createElement('p');
        durationElement.textContent = `Duration: ${subscription.duration}`;
        card.appendChild(durationElement);

        subscriptionCards.appendChild(card);
      });

      // Show the subscription cards section
      subscriptionCards.style.display = 'block';
    })
    .catch(error => {
      console.error('Error fetching subscriptions:', error);
    });
}


  </script>
</body>

</html>